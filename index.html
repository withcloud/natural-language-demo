<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Natural Language</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" type="text/css" href="jquery.toast.min.css" />
  <link rel="icon" href="assets/web_icon.svg">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/SpeechKITT/0.3.0/speechkitt.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="./scripts/jquery-3.6.0.min.js"></script>
  <script src="./scripts/jquery.toast.min.js"></script>
  <script src="./scripts/echarts.js"></script>
  <script src="./scripts/lodash.min.js"></script>
</head>

<body>
  <!-- 開始頁面 -->
  <div id='main'
    style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;display: block;">
    <div
      style="position: absolute; right:20px ; top: 20px; font-size: 30px;  color: white; border: 1px solid white; padding: 5px 10px ; border-radius: 10px;">
      *建議使用 google chrome 瀏覽器.</div>
    <div id='main_title' class="main_title web">聲音中的喜怒哀樂</div>
    <img class='frame' id='non_intractive' src=assets/frame.svg></img>
    <div class="main_button">
      <button onclick="language_game(1)">開始</button>
      <!-- <button onclick="language_game(2)">English</button> -->
      <!-- <button onclick="language_game(3)">portugues</button> -->
    </div>
  </div>

  <!-- 中文簡介 -->
  <div id='introduction_chinese' class="introduction">
    <div style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;">
      <div id='main_title' class="main_title web">在這頁會介紹相關原理跟說明讓用戶對語音辨識技術及NLP算法有一定了解。</div>
      <div class="main_button" style="justify-content: center;">
        <button class='introduction_start' onclick="language_start('chinese')">開始</button>
      </div>
    </div>
  </div>

  <!-- 英文簡介 -->
  <div id='introduction_english' class="introduction">
    <div style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;">
      <div id='main_title' class="main_title web">English</div>
      <div class="main_button" style="justify-content: center;">
        <button class='introduction_start' onclick="language_start('english')">Start</button>
      </div>
    </div>
  </div>

  <!-- 葡文簡介 -->
  <div id='introduction_portuguese' class="introduction">
    <div style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;">
      <div id='main_title' class="main_title web">Portugues</div>
      <div class="main_button" style="justify-content: center;">
        <button class='introduction_start' onclick="language_start('portuguese')">開始</button>
      </div>
    </div>
  </div>

  <!-- 輸入PIN嗎頁面 -->
  <section id="pinInputPage" class="w-full h-screen overflow-hidden relative" style="background:#4B4453;display: none;">
    <div class="game-canvas-delete" onclick="window.location.reload();">
      <img src="./assets/image/delete.png" alt="" />
    </div>
    <div class="w-full h-full flex flex-col justify-center py-12 sm:px-6 lg:px-8">
      <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
          <div class="mb-4">
            <div class="flex justify-center">
              <label class="block text-gray-700 font-medium mb-2 text-lg" for="pinInput">
                輸入你的PIN碼
              </label>
            </div>
            <input id="pinInput"
              class="h-16 text-5xl text-center shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline border-gray-300 disabled:cursor-not-allowed"
              type="text" value="" placeholder="" />
            <div id="pinKeyboard" class="mt-3 grid grid-cols-3 gap-1 hidden">
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                1
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                2
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                3
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                4
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                5
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                6
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                7
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                8
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                9
              </button>
              <button
                class="bg-rose-500 h-10 hover:bg-rose-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                重置
              </button>
              <button
                class="bg-teal-500 h-10 hover:bg-teal-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                0
              </button>
              <button
                class="bg-sky-500 h-10 hover:bg-sky-800 rounded-md m-0.5 text-white text-2xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2">
                關閉
              </button>
            </div>
          </div>

          <div class="flex items-center justify-center">
            <button id="pinStartBtn"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline h-12 text-xl disabled:bg-blue-300 disabled:cursor-not-allowed"
              type="button">
              開始遊戲
            </button>
          </div>
        </div>
      </div>
      <div class="mt-2 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
          <div class="flex justify-center">
            <label class="block text-gray-700 font-medium mb-2 text-lg" htmlFor="username">
              或是以新的用戶身份（請使用新用戶開始遊戲）
            </label>
          </div>
          <div class="flex items-center justify-center">
            <button id="startDirectlyBtn"
              class="bg-blue-500 disabled:bg-blue-300 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline h-12 text-xl"
              type="button">
              開始遊戲
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 語音翻譯 -->
  <div id='emotion_recognition' class='emotion_recognition' style='display: none;'>
    <div class="flex flex-col"
      style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;">
      <!-- 溫馨提示 -->
      <div class="absolute left-4 top-4 flex-col items-end font-medium text-[17px] text-white hidden xl:flex ">
        <p class="font-bold text-[24px] self-center">溫馨提示</p>
        <p class="font-bold text-[24px] self-center">請使用廣東話進行遊戲</p>
        <p>1. 嘗試對著麥克風說：”你好嗎？“</p>
        <p>2. 嘗試對著麥克風說：”我很快樂“</p>
        <p>3. 嘗試對著麥克風說：”我很生氣“</p>
      </div>

      <div>
        <div id="emotion_recognition_title" class="title">Emotion Recognition</div>
        <p class="font-bold text-[32px] text-white text-center block xl:hidden">請使用廣東話進行遊戲</p>

        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
          <textarea id='emotion_recognition_p' class="emotion_recognition_p" oninput="emotion_recognition_just();"
            disabled="disabled"></textarea>
          <div id='emotion_recognition_button' class="pt-4 flex justify-center items-center space-x-4">
            <button id="emotion_recognition_button_start" onclick="speechStart();"
              class="inline-flex items-center rounded-md border border-transparent bg-indigo-100 px-4 py-2 text-base font-medium text-indigo-700 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:bg-indigo-200 disabled:cursor-not-allowed">Start</button>
            <button id="emotion_recognition_button_stop" onclick="speechStop()"
              class="inline-flex items-center rounded-md border border-transparent bg-indigo-100 px-4 py-2 text-base font-medium text-indigo-700 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:bg-indigo-200 disabled:cursor-not-allowed hidden">Reset</button>
          </div>
        </div>
      </div>

      <div id="emotions_info" class="example_photo">
        <div id="positive_info">
          <img src="./assets/image/all/positive.png" class="m-auto" alt="">
          <p id="positive_str">Positive</p>
          <span id="emotion_recognition_positive_true" style="display: none;font-size: 42px;">✅</span>
        </div>
        <div id="natural_info">
          <img src="./assets/image/all/neutral.png" class="m-auto" alt="">
          <p id="natural_str">Natural</p>
          <span id="emotion_recognition_natural_true" style="display: none;font-size: 42px;">✅</span>
        </div>
        <div id="negetive_info">
          <img src="./assets/image/all/negative.png" class="m-auto" alt="">
          <p id="negetive_str">Negative</p>
          <span id="emotion_recognition_negetive_true" style="display: none;font-size: 42px;">✅</span>
        </div>
      </div>

      <div id="sentiments" class="main_title" style="text-align: center;color: white;"></div>

      <div class="main_button" style="justify-content: center;">
        <button id="emotion_recognition_button_nextPage" class='hand_shodow_next'
          onclick="emotion_recognition_next()">Next Page</button>
      </div>
    </div>
  </div>

  <!-- 情緒展示 -->
  <div id='emotion_recognition_result' style='display: none;'>
    <div style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;">
      <div id='emotion_recognition_result_title' class="title">Result（10）</div>
      <div id="example_photo" class="example_photo">
        <div id="Happy">
          <img src="./assets/image/all/positive.png" class="m-auto" alt="">
          <p id="emotion_recognition_result_positive_str">Positive <span id="positive_true" class=""
              style="display: none;font-size: 42px;">✅</span>
          </p>
          <p id="Happy_num"></p>
        </div>
        <div id="Emotion">
          <img src="./assets/image/all/neutral.png" class="m-auto" alt="">
          <p id="emotion_recognition_result_natural_str">Natural <span id="natural_true"
              style="display: none;font-size: 42px;">✅</span>
          </p>
          <p id="Emotion_num"></p>
        </div>
        <div id="Angry">
          <img src="./assets/image/all/negative.png" class="m-auto" alt="">
          <p id="emotion_recognition_result_negative_str">Negative <span id="negetive_true"
              style="display: none;font-size: 42px;">✅</span>
          </p>
          <p id="Angry_num"></p>
        </div>
      </div>
      <!-- <div class="main_button" style="justify-content: center;">
                <button class='qrcode_next' onclick="emotion_recognition_result_next()">下一頁</button>
            </div> -->
    </div>
  </div>

  <!-- 結束頁面 -->
  <!-- <div id='end_card' style='display: none;' >
        <div style="width: 100%; height: 100%; background:#4B4453; position: fixed; left:0px;top:0px;">
            <p class="endP">完了!</p>
            <div id='endButton' class="endButton web" onclick="again()">再來！（10）</div>
        </div>
    </div> -->
  <!-- 顯示總成績&PIN碼頁面 -->
  <section id="pinShowPage" class="w-full h-full bg-gray-200 overflow-hidden" style="background:#4B4453;display: none;">
    <div class="min-h-screen flex flex-col justify-center py-12 sm:px-6 lg:px-8">
      <div class="mt-1 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
          <div id="eChartsMain" style="width: 400px; height: 250px"></div>
        </div>
      </div>
      <div class="mt-2 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
          <div class="flex justify-center">
            <label class="block text-gray-700 font-medium mb-1 text-lg">
              你的用戶PIN碼
            </label>
          </div>
          <div class="flex justify-center">
            <label id="showPinLabel" class="py-2 px-3 text-gray-700 shadow text-center text-5xl">
            </label>
          </div>
          <div class="flex justify-center">
            <label class="block text-gray-700 font-medium mt-1 text-sm">
              請記住這組PIN碼以在其它遊戲使用
            </label>
          </div>
        </div>
      </div>

      <div class="flex items-center justify-center">
        <button id="endButton"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline h-12 text-xl"
          onclick="again()" type="button">
          再來！（10）
        </button>
      </div>
    </div>
  </section>
</body>
<script id="static_val">
  // 網絡地址
  const HOST = "https://pincode-beta.vercel.app";

  // 定義PIN輸入相關變量
  let pinInput = "";
  let local_user = {};

  const items = [
    "數據科學",
    "謎",
    "機器都識學習",
    "你畫我猜",
    "5G的速度",
    "姿勢捕捉",
    "聲音中的喜怒哀樂",
  ];

  let Happy_num = 0
  let Emotion_num = 0
  let Angry_num = 0

  const GAME_NAME = "聲音中的喜怒哀樂";
  const scoresData = [];
</script>
<script src="scripts/transition.js"></script>

<script id="pinInputPageFunc" type="module">
  // 定義PIN輸入相關函數和變量
  let pinKeyboardIsOpen = false;
  const pinChange = (inputValue, isReset = false) => {
    if (isReset === true) {
      pinInput = "";
    } else pinInput + inputValue;
  };

  const setKeyboardOpen = (bool = false) => {
    if (bool) {
      pinKeyboardIsOpen = true;
      $("#pinKeyboard").removeClass("hidden");
    } else {
      pinKeyboardIsOpen = false;
      $("#pinKeyboard").addClass("hidden");
    }
  };

  const setDisabled = (elementId, bool = false) => {
    if (elementId) {
      if (bool) {
        $(`#${elementId}`).prop("disabled", true);
      } else {
        $(`#${elementId}`).prop("disabled", false);
      }
    }
  };

  const userStart = async () => {
    setDisabled("pinStartBtn", true);
    setDisabled("startDirectlyBtn", true);

    // 獲取用戶
    try {
      const data = await fetch(`${HOST}/api/user/get?pin=${pinInput}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      }).then((res) => res.json());

      if (!data || !data?.id) {
        setDisabled("pinStartBtn", false);
        setDisabled("startDirectlyBtn", false);
        console.error("找不到對應的用戶");
        $.toast({
          heading: "Error",
          text: "找不到該用戶",
          showHideTransition: "fade",
          icon: "error",
        });
      } else {
        setDisabled("pinStartBtn", false);
        setDisabled("startDirectlyBtn", false);
        $("#pinInputPage").addClass("hidden");
        $("#secondIntroPage").removeClass("hidden");
      }
    } catch (error) {
      $.toast({
        heading: "Error",
        text: error.message,
        showHideTransition: "fade",
        icon: "error",
      });
      console.error(error.message);
      setDisabled("pinStartBtn", false);
      setDisabled("startDirectlyBtn", false);
    }
  };

  const newStart = async () => {
    var startDirectlyBtn = document.getElementById('startDirectlyBtn')
    startDirectlyBtn.innerText = "正在創建新用戶..."
    setDisabled("pinStartBtn", true);
    setDisabled("startDirectlyBtn", true);
    // 建立用戶
    try {
      const user = await fetch(`${HOST}/api/user/create`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      }).then((res) => res.json());

      if (user.error) {
        setDisabled("pinStartBtn", false);
        setDisabled("startDirectlyBtn", false);
        throw new Error(user.error);
      } else {
        local_user = user;
        if (local_user) {
          pinInput = local_user.pin;
        }

        pin_code_start()
      }
      setDisabled("pinStartBtn", false);
      setDisabled("startDirectlyBtn", false);
    } catch (error) {
      console.error("發生錯誤:", error);

      // 顯示在 toast
      $.toast({
        heading: "Error",
        text: error.message,
        showHideTransition: "fade",
        icon: "error",
      });
    }
  };
  // 定義DOM函數
  $("#pinInput").focus(() => {
    if (!pinKeyboardIsOpen) {
      setKeyboardOpen(true);
    }
  });
  $("#pinStartBtn").click(() => {
    userStart();
  });

  $("#startDirectlyBtn").click(() => {
    newStart();
  });

  for (let index = 1; index <= 12; index++) {
    // 給小鍵盤所有按鈕賦值
    if (index === 10) {
      $(`#pinKeyboard button:nth-child(${index})`).click(() => {
        $("#pinInput").val((pinInput = ""));
      });
    }
    if (index === 11) {
      $(`#pinKeyboard button:nth-child(${index})`).click(() => {
        $("#pinInput").val((pinInput += "0"));
      });
    }
    if (index === 12) {
      $(`#pinKeyboard button:nth-child(${index})`).click(() => {
        if (pinKeyboardIsOpen) {
          setKeyboardOpen();
        }
      });
    }
    if (index !== 10 && index !== 11 && index !== 12) {
      $(`#pinKeyboard button:nth-child(${index})`).click(() => {
        $("#pinInput").val((pinInput += index));
      });
    }
  }
</script>

<!-- 顯示總成績&PIN碼頁面函數 -->
<script id="pinShowPageFunc" type="module">
  $("#endGameBtn").click(() => {
    window.location.reload();
  });
</script>

</html>